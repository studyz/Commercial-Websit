/*
 * @name        EasyZoom
 * @author      Matt Hinchliffe <>
 * @modified    Tuesday, September 6th, 2016
 * @version     2.4.0
 */
!function(j){function k(a,d){this.$target=j(a),this.opts=j.extend({},r,d,this.$target.data()),void 0===this.isOpen&&this._init()}var l,m,n,o,p,q,r={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,linkAttribute:"href",preventClicks:!0,beforeShow:j.noop,beforeHide:j.noop,onShow:j.noop,onHide:j.noop,onMove:j.noop};k.prototype._init=function(){this.$link=this.$target.find("a"),this.$image=this.$target.find("img"),this.$flyout=j('<div class="easyzoom-flyout" />'),this.$notice=j('<div class="easyzoom-notice" />'),this.$target.on({"mousemove.easyzoom touchmove.easyzoom":j.proxy(this._onMove,this),"mouseleave.easyzoom touchend.easyzoom":j.proxy(this._onLeave,this),"mouseenter.easyzoom touchstart.easyzoom":j.proxy(this._onEnter,this)}),this.opts.preventClicks&&this.$target.on("click.easyzoom",function(b){b.preventDefault()})},k.prototype.show=function(c,d){var e,f,s,t,u=this;if(this.opts.beforeShow.call(this)!==!1){if(!this.isReady){return this._loadImage(this.$link.attr(this.opts.linkAttribute),function(){(u.isMouseOver||!d)&&u.show(c)})}this.$target.append(this.$flyout),e=this.$target.width(),f=this.$target.height(),s=this.$flyout.width(),t=this.$flyout.height(),l=this.$zoom.width()-s,m=this.$zoom.height()-t,0>l&&(l=0),0>m&&(m=0),n=l/e,o=m/f,this.isOpen=!0,this.opts.onShow.call(this),c&&this._move(c)}},k.prototype._onEnter=function(c){var d=c.originalEvent.touches;this.isMouseOver=!0,d&&1!=d.length||(c.preventDefault(),this.show(c,!0))},k.prototype._onMove=function(b){this.isOpen&&(b.preventDefault(),this._move(b))},k.prototype._onLeave=function(){this.isMouseOver=!1,this.isOpen&&this.hide()},k.prototype._onLoad=function(b){b.currentTarget.width&&(this.isReady=!0,this.$notice.detach(),this.$flyout.html(this.$zoom),this.$target.removeClass("is-loading").addClass("is-ready"),b.data.call&&b.data())},k.prototype._onError=function(){var b=this;this.$notice.text(this.opts.errorNotice),this.$target.removeClass("is-loading").addClass("is-error"),this.detachNotice=setTimeout(function(){b.$notice.detach(),b.detachNotice=null},this.opts.errorDuration)},k.prototype._loadImage=function(a,e){var f=new Image;this.$target.addClass("is-loading").append(this.$notice.text(this.opts.loadingNotice)),this.$zoom=j(f).on("error",j.proxy(this._onError,this)).on("load",e,j.proxy(this._onLoad,this)),f.style.position="absolute",f.src=a},k.prototype._move=function(c){if(0===c.type.indexOf("touch")){var d=c.touches||c.originalEvent.touches;p=d[0].pageX,q=d[0].pageY}else{p=c.pageX||p,q=c.pageY||q}var e=this.$target.offset(),f=q-e.top,g=p-e.left,h=Math.ceil(f*o),s=Math.ceil(g*n);if(0>s||0>h||s>l||h>m){this.hide()}else{var t=-1*h,u=-1*s;this.$zoom.css({top:t,left:u}),this.opts.onMove.call(this,t,u)}},k.prototype.hide=function(){this.isOpen&&this.opts.beforeHide.call(this)!==!1&&(this.$flyout.detach(),this.isOpen=!1,this.opts.onHide.call(this))},k.prototype.swap=function(a,e,f){this.hide(),this.isReady=!1,this.detachNotice&&clearTimeout(this.detachNotice),this.$notice.parent().length&&this.$notice.detach(),this.$target.removeClass("is-loading is-ready is-error"),this.$image.attr({src:a,srcset:j.isArray(f)?f.join():f}),this.$link.attr(this.opts.linkAttribute,e)},k.prototype.teardown=function(){this.hide(),this.$target.off(".easyzoom").removeClass("is-loading is-ready is-error"),this.detachNotice&&clearTimeout(this.detachNotice),delete this.$link,delete this.$zoom,delete this.$image,delete this.$notice,delete this.$flyout,delete this.isOpen,delete this.isReady},j.fn.easyZoom=function(a){return this.each(function(){var b=j.data(this,"easyZoom");b?void 0===b.isOpen&&b._init():j.data(this,"easyZoom",new k(this,a))})},"function"==typeof define&&define.amd?define(function(){return k}):"undefined"!=typeof module&&module.exports&&(module.exports=k)}(jQuery);